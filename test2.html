<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

</body>
<script>
    let tableList = []
/**
       * 判断对象是否为空
       * @param obj 对象
       * @returns {boolean} 为空返回true，不为空返回false
       */
       function isEmptyObj(obj) {
          //如果对象的键数组的长度是0，表示为空对象
          return Object.keys(obj).length === 0;
      }
      /**
       * 找到两个相同结构的对象的差异内容，并返回包含所有差异的数组
       * 注意对象内的值只能是简单类型，复杂类型不考虑
       * @param obj1 原对象
       * @param obj2 可能修改过的对象
       * @returns {{}} 包含所有差异的数组
       */
      function findObjOperate(obj1, obj2) {
        const resultObj = {};
        //遍历obj1的键数组，因为obj1和obj2结构相同，所以不考虑结构上的差异
        Object.keys(obj1).forEach(key => {
            if (obj1[key] !== obj2[key]) {
                //将变化过的属性挂载到返回对象中
                resultObj[key] = obj2[key];
            }
        });
        return resultObj;
      }

      /**
       * 找到两个对象数组的差异，并打印从oldList到newList的所有变化
       * 注意约定id不能修改
       * @param oldList 原数组
       * @param newList 可能修改过的数组
       */
      function findOperate(oldList, newList) {
        //用于记录id值和索引值之间差别的平衡值（以下简称平衡值）
        let step = 0;
        //遍历newList
        newList.forEach((obj2, index) => {
            //当前id和平衡过差值后的索引值（以下简称新索引值）还是不等
            if (obj2.id !== index + step) {
                //当前id和新索引值之间的差值就是被删除对象的个数
                for (let j = index + step; j < obj2.id; j++) {

                  oldList[j]['ywType']='del';
                  for(let key in oldList[j]){
                    oldList[j]['detail'][key] = {'bgq':oldList[j][key],'bgh':'','sfbg':false}
                  }
                  tableList.push(oldList[j])
                  console.log('delete', oldList[j]);

                }
                //更新平衡值
                step = obj2.id - index;
            }
            //根据新索引值在oldList中找到对应的对象
            const obj1 = oldList[index + step];
            if (obj1) {
                //比较obj1和obj2的差异
                const objOperateObj = findObjOperate(obj1, obj2);
                //如果返回的对象为空对象，表示没有差异
                if (!isEmptyObj(objOperateObj)) {
                    console.log('modify', obj1.id,objOperateObj);
                }else{
                  for(let key in objOperateObj){
                    objOperateObj['detail'][key] = {'bgq':objOperateObj[key],'bgh':objOperateObj[key],'sfbg':false}
                  }
                  tableList.push(objOperateObj)
                }
            } else {
                //js没有下标越界，所以如果obj1是undefined，那么obj2就是新增出的对象

                obj2['ywType']='add'
                for(let key in obj2){
                    obj2['detail'][key] = {'bgq':'','bgh':obj2[key],'sfbg':false}
                }
                tableList.push(obj2)

                console.log('add', obj2);
            }
        });
      }
      let bgq = [
                    {
                        "id": "2c9081a283d5de0e0183e377dc4d001f",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "王五",
                        "qtgdxb": "1",
                        "qtgdgj": "142",
                        "jjrzch": "222",
                        "zw": "333",
                        "czje": "444",
                        "czbl": "44",
                        "dacfdw": "111",
                        "sfgs": "0",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-17 17:06:19",
                        "xgid": "8a1bc22681c877000181c8794a65000c",
                        "xgsj": "2022-10-17 17:07:21",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "312"
                    },
                    {
                        "id": "2c9081a283d5de0e0183e387361d003a",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "威威",
                        "qtgdxb": "1",
                        "qtgdgj": "142",
                        "jjrzch": "222",
                        "zw": "333",
                        "czje": "444",
                        "czbl": "44",
                        "dacfdw": "111",
                        "sfgs": "0",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-17 17:06:19",
                        "xgid": "8a1bc22681c877000181c8794a65000c",
                        "xgsj": "2022-10-17 17:07:21",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "123"
                    },
                    {
                        "id": "4028812583e38ffd0183e3a59d620009",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "哈哈哈",
                        "qtgdxb": "1",
                        "qtgdgj": "142",
                        "jjrzch": "222",
                        "zw": "333",
                        "czje": "444",
                        "czbl": "44%",
                        "dacfdw": "111",
                        "sfgs": "0",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-17 17:06:19",
                        "xgid": "8a1bc22681c877000181c8794a65000c",
                        "xgsj": "2022-10-17 17:07:21",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "123456"
                    },
                    {
                        "id": "2c9081a283d5de0e0183d5e8b0500001",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "李四",
                        "qtgdxb": "1",
                        "qtgdgj": "142",
                        "jjrzch": "222",
                        "zw": "333",
                        "czje": "444",
                        "czbl": "44",
                        "dacfdw": "111",
                        "sfgs": "0",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-17 17:06:19",
                        "xgid": "8a1bc22681c877000181c8794a65000c",
                        "xgsj": "2022-10-17 17:07:25",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "321"
                    }
                ];
            let bgh=[
                    {
                        "id": "2c9081a283d5de0e0183d5e8b0500001",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "李四",
                        "qtgdxb": "1",
                        "qtgdgj": "142",
                        "jjrzch": "222",
                        "zw": "333",
                        "czje": "444",
                        "czbl": "44",
                        "dacfdw": "111",
                        "sfgs": "1",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-18 10:56:40",
                        "xgid": "8a1bc22681c877000181c8794a65000c",
                        "xgsj": "2022-10-17 17:34:30",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "321"
                    },
                    {
                        "id": "4028812583e9047d0183e90551c90000",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "赵六",
                        "qtgdxb": "2",
                        "qtgdgj": "142",
                        "jjrzch": "阿松大",
                        "zw": "a是",
                        "czje": "1000",
                        "czbl": "10%",
                        "dacfdw": "阿松大",
                        "sfgs": "1",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-18 10:56:40",
                        "xgid": "",
                        "xgsj": "",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "123456"
                    },
                    {
                        "id": "2c9081a283d5de0e0183e377dc4d001f",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "王五1",
                        "qtgdxb": "1",
                        "qtgdgj": "142",
                        "jjrzch": "222-1",
                        "zw": "333",
                        "czje": "444-1",
                        "czbl": "44",
                        "dacfdw": "111",
                        "sfgs": "1",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-18 10:56:39",
                        "xgid": "8a1bc22681c877000181c8794a65000c",
                        "xgsj": "2022-10-17 17:33:53",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "312"
                    },
                    {
                        "id": "2c9081a283d5de0e0183e387361d003a",
                        "jgid": "8a1bc22681c877000181c8794a65000c",
                        "jgmc": "",
                        "jgbaz": "",
                        "qtgdxm": "威威",
                        "qtgdxb": "1",
                        "qtgdgj": "142",
                        "jjrzch": "222",
                        "zw": "333",
                        "czje": "444",
                        "czbl": "44",
                        "dacfdw": "111",
                        "sfgs": "1",
                        "sfsc": "0",
                        "cjid": "8a1bc22681c877000181c8794a65000c",
                        "cjsj": "2022-10-18 10:56:40",
                        "xgid": "8a1bc22681c877000181c8794a65000c",
                        "xgsj": "2022-10-17 17:34:30",
                        "ids": "",
                        "zjlx": "2",
                        "zjhm": "123"
                    }
                ]

                // findOperate(arr1,arr2)
                // let bgq = this.list.dtoQtgdList.bgq,bgh=this.list.dtoQtgdList.bgh;
                for(let i=0;i<bgh.length;i++){
                    let current = bgq.filter(item=>{return item.id==bgh[i].id})[0];
                    let noData = bgq.filter(item=>{return item.id!=bgh[i].id})[0];
                    let detailObj = {};
                    if(current){
                        for(let key in bgh[i]){
                            if(bgh[i][key]==current[key]){
                                detailObj[key]={'bgq':current[key],'bgh':bgh[i][key],'sfbg':false}
                                // this.$set(detailObj,key,{'bgq':current[key],'bgh':bgh[i][key],'sfbg':false})
                            }else{
                                // this.$set(detailObj,key,{'bgq':current[key],'bgh':bgh[i][key],'sfbg':true})
                                detailObj[key]={'bgq':current[key],'bgh':bgh[i][key],'sfbg':true}
                            }
                        }
                        bgh[i]['detail']=detailObj;
                        tableList.push(bgh[i])
                    }
                    if(noData){
                        //删除
                        if(bgq.filter(item=>{return item.id==noData.id}).length>0){
                            for(let key in noData){
                                detailObj[key]={'bgq':noData[key],'bgh':'','sfbg':false}
                                // this.$set(detailObj,key,{'bgq':noData[key],'bgh':'','sfbg':false})
                            }
                            noData['ywType']='del';
                            noData['detail']=detailObj;
                            tableList.push(noData);
                        }else{
                            //新增
                            for(let key in noData){
                                detailObj[key]={'bgq':'','bgh':noData[key],'sfbg':false}
                                // this.$set(detailObj,key,{'bgq':'','bgh':noData[key],'sfbg':false})
                            }
                            noData['ywType']='add';
                            noData['detail']=detailObj;
                            tableList.push(noData);
                        }
                    }
                }
                console.log(tableList)
</script>
</html>